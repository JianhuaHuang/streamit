---
title: "Untitled"
author: "Jianhua Huang"
date: "July 21, 2016"
output: ioslides_presentation
---

```{r setup, include=FALSE}
rm(list = ls())
library(knitr)
library(caret)
library(dplyr)
library(rpart)
library(rattle)
library(survival)

dir <- 'F:/Projects/Rpackage/streamit'
opts_chunk$set(echo = TRUE, root.dir = dir)
source('F:/Projects/Rpackage/streamit/R/myFun.R')
```


## Data Preparation
```{r}
dt <- survival::pbc %>%
  transmute(age = round(age), sex, platelet, stage = as.character(stage), 
    time, status = as.numeric(status %in% c(1, 2)))
dim(dt)
str(dt)
kable(head(dt))
```


## Split Data into Training and Test datasets
```{r}
set.seed(12345)
ind.train <- createDataPartition(dt$status, p = .7, list = FALSE)
dt.train <- dt[ind.train, ]
dt.test <- dt[-ind.train, ]
dim(dt.train)
dim(dt.test)
```

## Binning Based on rpart (recursive partitioning)
```{r}
rpart(formula = status ~ age, data = dt.train, 
  control = rpart.control(minbucket = .05 * nrow(dt.train)))

lg.bin.age <- bin.rpart(formula = status ~ age, data = dt.train, 
  rcontrol = rpart.control(minbucket = .05 * nrow(dt.train)))

surv.bin.age <- bin.rpart(formula = Surv(time, status) ~ age, data = dt.train,
  rcontrol = rpart.control(minbucket = .05 * nrow(dt.train)))

surv.bin.age2 <- bin.rpart(formula = Surv(time, status) ~ age, data = dt.train,
  rcontrol = rpart.control(minbucket = .05 * nrow(dt.train)), n.group = 3:6)

```
